<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">

<html>
<head>
  <meta name="generator" content=
  "HTML Tidy for Linux (vers 25 March 2009), see www.w3.org">
  <meta content="text/html; charset=utf-8" http-equiv=
  "content-type">

  <title></title>
  <link rel="stylesheet" href="problem.css" type="text/css">
  <script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: { 
    ignoreClass: ".*",
    inlineMath: [['$','$'], ['\\(','\\)']]
        },
  MMLorHTML: {
    prefer: {Firefox: "HTML"}
    }
  });
  </script>
  <script type="text/javascript" src=
  "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
</head>

<body>
  <div class="problembody">
    <div class="problemheader">
      <h1>Codenames</h1>

      <h3>Problem ID: codenames</h3>
    </div>

    <p>Codenames is a popular board game. Two teams compete by each
    having a “spymaster” give one-word clues that can point to
    multiple words on the board. The other players on the team
    attempt to guess their team’s words while avoiding the words of
    the other team. The objective is to be the first team to have
    all their team’s words revealed.</p>

    <p>Players split into two teams: red and blue. One player of
    each team is selected as the team’s spymaster; the others are
    field operatives.</p>

    <p><span class="tex2jax_process">$N$</span> Codename cards,
    each bearing a word, are laid out in a line. Each word
    represents one of the following: a red agent, a blue agent, an
    assassin, or an innocent bystander. All players can see all the
    Codename words, but only the spymasters know the identities of
    the cards.</p>

    <p>Teams take turns. On each turn, the appropriate spymaster
    gives a verbal hint about the words on the respective cards.
    Each hint may only consist of one single word and a number. The
    spymaster’s hint should be as close to their own agents’ cards
    as possible. The hint’s number tells the field operatives the
    maximum number of guesses to make.</p>

    <p>After a spymaster gives the hint, their field operatives
    make guesses about which Codename cards bear words related to
    the hint and point them out, one at a time. When a Codename
    card is pointed out, the spymaster reveals the identity of that
    card-–-a blue agent card, a red agent card, an innocent
    bystander card, or the assassin card. Depending on the identity
    of the card, one of these things happens:</p>

    <ul class="itemize">
      <li>
        <p>If an assassin is pointed out, the game ends
        immediately, and their team loses.</p>
      </li>

      <li>
        <p>If an innocent bystander is pointed out, the turn simply
        ends.</p>
      </li>

      <li>
        <p>If an agent of the other team is pointed out, the turn
        ends, and that other team is one agent closer to
        winning.</p>
      </li>

      <li>
        <p>If an agent of their team is pointed out, they are one
        agent closer to winning, and they may choose to make
        another guess.</p>
      </li>
    </ul>

    <p>The game ends when all of one team’s agents are identified
    (winning the game for that team), or when one team has
    identified the assassin (losing the game).</p>

    <p>To simplify the problem, let’s assume that both teams share
    the same dictionary of hint words and their associations with
    Codename cards. For example, consider this board (<span class=
    "tex2jax_process">$N = 6$</span>):<br></p>

    <div id="table:codenameHints" class="table">
      <center>
        <table cellspacing="0" class="tabular">
          <tr>
            <td style="text-align:left">
              <p><tt class="tt">Plate</tt>(R)</p>
            </td>

            <td style="text-align:left">
              <p><tt class="tt">Screen</tt>(I)</p>
            </td>

            <td style="text-align:left">
              <p><tt class="tt">Novel</tt>(A)</p>
            </td>

            <td style="text-align:left">
              <p><tt class="tt">Robin</tt>(B)</p>
            </td>

            <td style="text-align:left">
              <p><tt class="tt">Iron</tt>(R)</p>
            </td>

            <td style="text-align:left">
              <p><tt class="tt">Server</tt>(B)</p>
            </td>
          </tr>
        </table>

        <div class="caption">
          <b>Table 1</b>: (R: Red team’s agent; B: Blue team’s
          agent; I: Innocent bystander; A: Assassin)
        </div>
      </center>
    </div>

    <p>Next, consider these hint words and associated Codename
    cards:</p>

    <div id="a0000000002" class="table">
      <center>
        <table cellspacing="0" class="tabular">
          <tr>
            <td style=
            "border-top-style:solid; border-left:1px solid black; border-right:1px solid black; border-top-color:black; border-top-width:1px; text-align:left">
            <p><tt class="tt">Alfred</tt></p>
            </td>

            <td style=
            "border-top-style:solid; text-align:left; border-top-color:black; border-top-width:1px; border-right:1px solid black">
            <p><tt class="tt">Robin, Server, Plate</tt></p>
            </td>
          </tr>

          <tr>
            <td style=
            "text-align:left; border-right:1px solid black; border-left:1px solid black">
            <p><tt class="tt">Net</tt></p>
            </td>

            <td style=
            "text-align:left; border-right:1px solid black">
              <p><tt class="tt">Server, Screen, Plate</tt></p>
            </td>
          </tr>

          <tr>
            <td style=
            "text-align:left; border-right:1px solid black; border-left:1px solid black">
            <p><tt class="tt">Computer</tt></p>
            </td>

            <td style=
            "text-align:left; border-right:1px solid black">
              <p><tt class="tt">Screen, Server</tt></p>
            </td>
          </tr>

          <tr>
            <td style=
            "text-align:left; border-right:1px solid black; border-left:1px solid black">
            <p><tt class="tt">Twitter</tt></p>
            </td>

            <td style=
            "text-align:left; border-right:1px solid black">
              <p><tt class="tt">Screen, Robin, Server</tt></p>
            </td>
          </tr>

          <tr>
            <td style=
            "text-align:left; border-right:1px solid black; border-left:1px solid black">
            <p><tt class="tt">Crusoe</tt></p>
            </td>

            <td style=
            "text-align:left; border-right:1px solid black">
              <p><tt class="tt">Robin, Novel</tt></p>
            </td>
          </tr>

          <tr>
            <td style=
            "border-bottom-style:solid; border-bottom-width:1px; border-left:1px solid black; border-right:1px solid black; text-align:left; border-bottom-color:black">
            <p><tt class="tt">Film</tt></p>
            </td>

            <td style=
            "border-bottom-color:black; border-bottom-width:1px; text-align:left; border-bottom-style:solid; border-right:1px solid black">
            <p><tt class="tt">Iron, Screen</tt></p>
            </td>
          </tr>
        </table>

        <div class="caption">
          <b>Table 2</b>: A list of hint words and their associated
          Codename cards.
        </div>
      </center>
    </div>

    <p>Once the spymaster gives a hint word and a number,
    <span class="tex2jax_process">$K$</span> (an integer between 1
    and the number of unrevealed words associated with the hint),
    their field operatives make random guesses—with equal
    probability—from the list of associated words that are not
    revealed yet. They will continue to make guesses until one of
    the following happens: (1) they get <span class=
    "tex2jax_process">$K$</span> hits, (2) they have won the game,
    or (3) their turn ends with a miss. They will never make
    guesses outside the list or use hints from the previous rounds.
    It is illegal for the spymaster to give a hint word whose all
    associated Codename cards have already been revealed. All hint
    words can be used multiple times by either team.</p>

    <p>For example, assuming blue team goes first in the first
    round, the blue spymaster may give a hint “Twitter, 2”. The
    blue team has <span class="tex2jax_process">$1/3$</span> chance
    of guessing “Screen”, “Robin” and “Server”, respectively. If
    they happen to guess “Screen”, their turn ends as the word is
    an innocent bystander. Otherwise, they get a hit and will make
    another guess, with <span class="tex2jax_process">$1/2$</span>
    chance on either of the remaining two words. Regardless of the
    choice, their turn will end after this guess, and the red team
    will start their team with the red spymaster giving a hint.</p>

    <p>Now you are selected as the spymaster, and your team (color
    specified in the input) goes first. Assuming both spymasters
    play optimally, what is your probability of winning the
    game?</p>

    <h2>Input</h2>

    <p>The first line consists of an integer and a character,
    separated by a single space. The integer is <span class=
    "tex2jax_process">$N$</span> (<span class="tex2jax_process">$1
    \leq N \leq 15$</span>), the size of the board. The character
    is R or B, indicating your team (red or blue).</p>

    <p>The second line consists of <span class=
    "tex2jax_process">$N$</span> distinct words, separated by a
    single space. Each word consists of up to 20 lowercase English
    letters.</p>

    <p>The third line consists of <span class=
    "tex2jax_process">$N$</span> single-character strings,
    separated by a single space. The <span class=
    "tex2jax_process">$i$</span>-th string indicates the identity
    of the <span class="tex2jax_process">$i$</span>-th word, with
    the following meaning: R—Red team’s agent; B—Blue team’s agent;
    I—Innocent bystander; A—Assasin. There are one or more “R” and
    “B” words, and there are zero or more “I” and “A” words.</p>

    <p>The fourth line consists of an integer <span class=
    "tex2jax_process">$M$</span> (<span class="tex2jax_process">$1
    \leq M \leq 50$</span>), which is the number of hint words.</p>

    <p>Each of the following <span class=
    "tex2jax_process">$M$</span> lines consists of an integer
    <span class="tex2jax_process">$H_ i$</span> (<span class=
    "tex2jax_process">$1 \leq H_ i \leq N$</span>), followed by
    <span class="tex2jax_process">$H_ i$</span> distinct words
    separated by a single space. It describes the associated
    Codename cards with the <span class=
    "tex2jax_process">$i$</span>-th hint word. All words are
    guaranteed to appear on the board.</p>

    <h2>Output</h2>

    <p>Probability of winning the game. Your answer will be
    considered correct if it has absolute error at most
    <span class="tex2jax_process">$10^{-4}$</span> with judge
    data.</p>

    <h2>Sample Explanation</h2>

    <p>The blue spymaster has three hint words to choose from (in
    any case, their team can only make one guess in the turn, so
    the choice of <span class="tex2jax_process">$K$</span> does not
    matter):</p>

    <ol class="enumerate">
      <li>
        <p>If they choose the first, their team has <span class=
        "tex2jax_process">$1/2$</span> probability of guessing
        “apple” and wins the game, and <span class=
        "tex2jax_process">$1/2$</span> probability of guessing
        “java” and ends the turn, which allows the red spymaster to
        give the third hint word and win. So the blue team’s
        winning chance is <span class=
        "tex2jax_process">$1/2$</span> in this case;</p>
      </li>

      <li>
        <p>If they choose the second, their team has <span class=
        "tex2jax_process">$1/2$</span> probability of guessing
        “apple” and wins the game, and <span class=
        "tex2jax_process">$1/2$</span> probability of guessing
        “dog” and loses the game. So the blue team’s winning chance
        is also <span class="tex2jax_process">$1/2$</span>;</p>
      </li>

      <li>
        <p>If they choose the third, their team has <span class=
        "tex2jax_process">$1/2$</span> probability of guessing
        “sleep” and loses the game, and <span class=
        "tex2jax_process">$1/2$</span> probability of guessing
        “java” and ends the turn, which allows the red spymaster to
        give the third hint word and win. So the blue team’s
        winning chance is <span class="tex2jax_process">$0$</span>
        in this case.</p>
      </li>
    </ol>

    <p>To sum up, the best strategy for the blue spymaster is
    either 1. or 2. and their winning chance is <span class=
    "tex2jax_process">$1/2$</span>.</p>

    <table class="sample" summary="sample data">
      <tr>
        <th>Sample Input 1</th>

        <th>Sample Output 1</th>
      </tr>

      <tr>
        <td>
          <pre>
4 B
apple sleep java dog
B R I A
3
2 apple java
2 apple dog
2 sleep java
</pre>
        </td>

        <td>
          <pre>
0.5000
</pre>
        </td>
      </tr>
    </table>
  </div>
</body>
</html>
